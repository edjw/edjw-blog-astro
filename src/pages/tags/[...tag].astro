---
import slugify from 'slugify';
import { titleCase } from "title-case";
import PageLayout from "../../layouts/PageLayout.astro";
import PostList from "../../components/PostList.astro"

export async function getStaticPaths() {
  const allPosts = Astro.fetchContent('../blog/*.md');
  let allUniqueTags = [...new Set(allPosts.map(post => post.tags).flat())].map(tag => slugify(tag));
  return allUniqueTags.map(tag => ({params: {tag}, props: {allPosts}}));
}
const { allPosts } = Astro.props;
const { params } = Astro.request;

const tag = params.tag.replace("-", " ")
const tagPosts = allPosts
  .filter((post) => post.tags.includes(tag))
const tagName = titleCase(tag);

---
<PageLayout title={tagName} socialDescription={`Blogposts about ${tagName}`}>
    <p>
        These are the blogposts I've tagged as <em>{tagName}</em>.
    </p>
    <PostList posts={tagPosts} />
</PageLayout>
