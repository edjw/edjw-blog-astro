---
import slugify from 'slugify';
import { titleCase } from "title-case";
import PageLayout from "$layouts/PageLayout.astro";
import PostList from "$components/PostList.astro"

export async function getStaticPaths() {
 const allPosts = Astro.fetchContent('../blog/*.md');
  let allUniqueTags = [...new Set(allPosts.map(post => post.tags).flat())];
  let sluggedTags = allUniqueTags.map(tag => slugify(tag));
  return sluggedTags.map(tag => ({params: {tag}, props: {allPosts}}));
}
const { allPosts } = Astro.props;
const { params } = Astro.request;

const tagPosts = allPosts
  .filter((post) => post.tags.includes(params.tag))
const tagName = titleCase(params.tag);

---
<PageLayout pageTitle={tagName} description={`Blogposts about ${tagName}`}>
    <h2>{tagName}</h2>
    <p>
        These are the blogposts I've tagged as <em>{tagName}</em>.
    </p>

    <PostList posts={tagPosts} />
</PageLayout>
