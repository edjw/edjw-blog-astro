---
import slugify from "slugify";
import { titleCase } from "title-case";
import PageLayout from "../../layouts/PageLayout.astro";
import PostList from "../../components/PostList.astro";

export async function getStaticPaths() {
  const allPosts = await Astro.glob("../blog/*.md");
  let allUniqueTags = [
    ...new Set(allPosts.map((post) => post.frontmatter.tags).flat()),
  ].map((tag) => slugify(tag));
  return allUniqueTags.map((tag) => ({ params: { tag }, props: { allPosts } }));
}
const { allPosts } = Astro.props;
const { tag } = Astro.params;

const cleanedTag = tag.replace("-", " ");
const tagPosts = allPosts.filter((post) => post.frontmatter.tags.includes(tag));
const tagName = titleCase(cleanedTag);
---

<PageLayout title={tagName} socialDescription={`Blogposts about ${tagName}`}>
  <p>
    These are the blogposts I've tagged as <em>{tagName}</em>.
  </p>
  <PostList posts={tagPosts} />
</PageLayout>
